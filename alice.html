<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Responsive Firebase Chatroom</title>
  <style>
    /* Reset and base */
    body {
      background: #18182c;
      color: #fff;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    h2 {
      margin: 16px;
      font-weight: 700;
      font-size: 1.6rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    button.clear-btn {
      background: #e23d4b;
      border: none;
      border-radius: 10px;
      padding: 8px 14px;
      font-weight: 700;
      font-size: 0.9rem;
      color: white;
      cursor: pointer;
      transition: background-color 0.2s ease-in-out;
      flex-shrink: 0;
    }

    button.clear-btn:hover {
      background: #c31827;
    }

    #whoami-wrapper {
      margin: 0 16px 8px 16px;
      font-size: 1rem;
      font-weight: 600;
    }

    #whoami {
      color: #00bbff;
      user-select: none;
      margin-left: 6px;
    }

    .chat-area {
      flex: 1;
      margin: 0 12px;
      padding: 12px 16px;
      background: #211d34;
      border-radius: 12px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 12px;
      scroll-behavior: smooth;
      /* Provide some bottom padding so last message is clear */
      padding-bottom: 24px;
    }

    .message {
      max-width: 75%;
      padding: 12px 18px;
      border-radius: 18px;
      font-size: 1rem;
      line-height: 1.3;
      word-wrap: break-word;
      user-select: text;
    }

    .sent {
      background: linear-gradient(135deg, #0088ff, #3722ff);
      color: white;
      align-self: flex-end;
      box-shadow: 0 3px 8px rgba(0, 136, 255, 0.4);
      border-bottom-right-radius: 4px;
    }

    .received {
      background: #333053;
      color: #cfdcff;
      align-self: flex-start;
      border-bottom-left-radius: 4px;
    }

    footer {
      padding: 14px 12px;
      background: #17172d;
      display: flex;
      gap: 10px;
      align-items: center;
      flex-shrink: 0;
    }

    #messageInput {
      flex-grow: 1;
      padding: 12px 16px;
      border-radius: 22px;
      border: none;
      background-color: #252542;
      color: #eee;
      font-size: 1rem;
      outline-offset: 2px;
    }

    #messageInput::placeholder {
      color: #8299b4;
    }

    button.send-btn {
      background-color: #00bbff;
      color: #222;
      border: none;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      font-weight: 700;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 0 10px rgba(0, 187, 255, 0.6);
      transition: background-color 0.2s ease;
      user-select: none;
    }

    button.send-btn:hover {
      background-color: #008fbf;
    }

    /* Scrollbar styles */
    .chat-area::-webkit-scrollbar {
      width: 6px;
    }
    .chat-area::-webkit-scrollbar-thumb {
      background: rgba(0, 187, 255, 0.5);
      border-radius: 4px;
    }
    .chat-area::-webkit-scrollbar-track {
      background: transparent;
    }

    /* Responsive tweaks */
    @media (max-width: 600px) {
      h2 {
        font-size: 1.3rem;
        margin: 12px 12px 12px 12px;
      }
      #whoami-wrapper {
        margin: 0 12px 8px 12px;
        font-size: 0.95rem;
      }
      .chat-area {
        margin: 0 8px;
        padding: 10px 12px;
        gap: 10px;
      }
      .message {
        max-width: 85%;
        padding: 10px 14px;
        font-size: 0.95rem;
      }
      #messageInput {
        font-size: 0.95rem;
        padding: 10px 14px;
      }
      button.clear-btn {
        padding: 8px 12px;
        font-size: 0.85rem;
      }
      button.send-btn {
        width: 44px;
        height: 44px;
        font-size: 18px;
      }
    }
  </style>
</head>
<body>
  <h2>
    Chatroom
    <button class="clear-btn" onclick="clearChat()">Clear All Messages</button>
  </h2>
  <div style="margin:0 0 10px 16px;">
    <b>Your Name:</b>
    <span id="whoami"></span>
  </div>
  <div class="chat-area" id="chatBox"></div>
  <footer>
    <input id="messageInput" type="text" placeholder="Type a message...">
    <button class="send-btn" onclick="sendMessage()">Send</button>
  </footer>

<script type="module">
  // ---- USER SETUP ----
  const currentUser = "Bob"; // Change to "Bob" on other device
  const otherUser = "Alice";     // Change to "Alice" on other device

  document.getElementById('whoami').textContent = currentUser;

  // ---- FIREBASE ----
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
  import { getDatabase, ref, push, onChildAdded, remove, onValue } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBbXkKAJHTaTq-ggM8PtyWItY90yDImn9Q",
    authDomain: "aller-ca816.firebaseapp.com",
    databaseURL: "https://aller-ca816-default-rtdb.firebaseio.com",
    projectId: "aller-ca816",
    storageBucket: "aller-ca816.appspot.com",
    messagingSenderId: "656252999207",
    appId: "1:656252999207:web:e54de216113c1bb33b2002",
    measurementId: "G-PVSKCK6MZ0"
  };
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const chatroomID = [currentUser, otherUser].sort().join("_");
  const chatRef = ref(db, `chatrooms/${chatroomID}`);

  const chatBox = document.getElementById('chatBox');
  const messageInput = document.getElementById('messageInput');

  function renderMessages(snapshot) {
    chatBox.innerHTML = "";
    const val = snapshot.val();
    if (!val) return; // No messages
    Object.values(val).forEach(msg => {
      if (!msg || !msg.text) return;
      const msgDiv = document.createElement('div');
      msgDiv.className = "message " + (msg.from === currentUser ? 'sent' : 'received');
      msgDiv.textContent = (msg.from === currentUser ? 'Me: ' : msg.from + ": ") + msg.text;
      chatBox.appendChild(msgDiv);
    });
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  onValue(chatRef, renderMessages);

  window.sendMessage = function() {
    const text = messageInput.value.trim();
    if (!text) return;
    push(chatRef, { from: currentUser, to: otherUser, text, timestamp: Date.now() });
    messageInput.value = "";
  };

  window.clearChat = function() {
    if (confirm('Are you sure you want to delete ALL messages in this chatroom for everyone?')) {
      remove(chatRef);
    }
  };

  messageInput.addEventListener('keydown', e => {
    if (e.key === "Enter") { sendMessage(); e.preventDefault(); }
  });
</script>
</body>
</html>
